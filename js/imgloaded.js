(()=>{class l{constructor(e,t){this.smallSrc=e,this.largeSrc=t,this.initTpl(),this.container.addEventListener("animationend",()=>{this.smallStage.style.display="none"},{once:!0}),this.initScrollHandler()}initTpl(){this.container=document.createElement("div"),this.smallStage=document.createElement("div"),this.largeStage=document.createElement("div"),this.smallImg=new Image,this.largeImg=new Image,this.container.className="pl-container",this.smallStage.className="pl-img pl-blur",this.largeStage.className="pl-img",this.container.appendChild(this.smallStage),this.container.appendChild(this.largeStage),this.smallImg.onload=this._onSmallLoaded.bind(this),this.largeImg.onload=this._onLargeLoaded.bind(this)}progressiveLoad(){this.smallImg.src=this.smallSrc,this.largeImg.src=this.largeSrc}_onLargeLoaded(){this.largeStage.classList.add("pl-visible"),this.largeStage.style.backgroundImage=`url('${this.largeSrc}')`}_onSmallLoaded(){this.smallStage.classList.add("pl-visible"),this.smallStage.style.backgroundImage=`url('${this.smallSrc}')`}initScrollHandler(){window.addEventListener("scroll",()=>{var e=window.pageYOffset||document.documentElement.scrollTop,t=document.documentElement.scrollHeight-window.innerHeight,e=Math.min(e/t*100,100),t=1+e/100*.2,e=(this.largeStage.style.filter=`blur(${e/100*20}px)`,document.getElementById("site-title"));e&&(e.style.transform=`scale(${t})`,e.style.transformOrigin="center",e.style.transition="transform 0.3s ease-out")})}}let a=(e,t)=>{console.log("执行渐进背景替换");var a=window.matchMedia("(max-width: 767px)").matches,a=new l(a?e.mobileSmallSrc:e.smallSrc,a?e.mobileLargeSrc:e.largeSrc);t.children[0]&&t.insertBefore(a.container,t.children[0]),a.progressiveLoad()},t={light:{smallSrc:"https://bu.dusays.com/2025/04/19/680297e97e95c.webp",largeSrc:"https://bu.dusays.com/2025/04/19/680297e97e95c.webp",mobileSmallSrc:"https://bu.dusays.com/2025/04/19/680297e97e95c.webp",mobileLargeSrc:"https://bu.dusays.com/2025/04/19/680297e97e95c.webp",enableRoutes:["/"]},dark:{smallSrc:"https://kkdrive.jisuk.top/f/kJMUW/6810aef884bc0.webp",largeSrc:"https://kkdrive.jisuk.top/f/kJMUW/6810aef884bc0.webp",mobileSmallSrc:"https://kkdrive.jisuk.top/f/kJMUW/6810aef884bc0.webp",mobileLargeSrc:"https://kkdrive.jisuk.top/f/kJMUW/6810aef884bc0.webp",enableRoutes:["/"]}},s=()=>document.documentElement.getAttribute("data-theme"),i=()=>{var e=s();let a=t[e];n(a),document.addEventListener("DOMContentLoaded",function(){n(a)}),document.addEventListener("pjax:complete",function(){var e,t;e=a,(t=document.getElementById("page-header"))&&t.classList.contains("full_page")&&n(e)})};var e=s();function n(e){var t=document.querySelector(".pl-container"),t=(t&&t.remove(),document.getElementById("page-header"));t&&t.classList.contains("full_page")&&a(e,t)}n(t[e]),new MutationObserver(e=>{e.forEach(e=>{"data-theme"===e.attributeName&&"/"===location.pathname&&i()})}).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]})})();